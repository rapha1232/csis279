{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { SECRET_KEY } from '@config';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\nimport { PrismaClient } from '@prisma/client';\nimport { NextFunction, Response } from 'express';\nimport { verify } from 'jsonwebtoken';\n\nconst getAuthorization = req => {\n  const { body } = req;\n\n  if (body && body.Authorization) {\n    const authorizationString = body.Authorization;\n    const parts = authorizationString.split('=');\n    if (parts.length === 2) {\n      return parts[1]; // Return what's after the equal sign\n    }\n  }\n\n  return null;\n};\n\nexport const AuthMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n  try {\n    const Authorization = getAuthorization(req);\n\n    if (Authorization) {\n      const { UserID } = (await verify(Authorization, SECRET_KEY)) as DataStoredInToken;\n      const users = new PrismaClient().user;\n      const findUser = await users.findUnique({ where: { UserID: Number(UserID) } });\n\n      if (findUser) {\n        req.user = findUser;\n        next();\n      } else {\n        next(new HttpException(401, 'Wrong authentication token'));\n      }\n    } else {\n      next(new HttpException(404, 'Authentication token missing'));\n    }\n  } catch (error) {\n    next(new HttpException(401, 'Wrong authentication token'));\n  }\n};\n"],"names":["AuthMiddleware","getAuthorization","req","body","Authorization","authorizationString","parts","split","length","res","next","UserID","verify","SECRET_KEY","users","PrismaClient","user","findUser","findUnique","where","Number","HttpException","error"],"mappings":";;;;+BAqBaA;;;eAAAA;;;wBArBc;+BACG;wBAED;8BAEN;AAEvB,MAAMC,mBAAmBC,CAAAA;IACvB,MAAM,EAAEC,IAAI,EAAE,GAAGD;IAEjB,IAAIC,QAAQA,KAAKC,aAAa,EAAE;QAC9B,MAAMC,sBAAsBF,KAAKC,aAAa;QAC9C,MAAME,QAAQD,oBAAoBE,KAAK,CAAC;QACxC,IAAID,MAAME,MAAM,KAAK,GAAG;YACtB,OAAOF,KAAK,CAAC,EAAE,EAAE,qCAAqC;QACxD;IACF;IAEA,OAAO;AACT;AAEO,MAAMN,iBAAiB,OAAOE,KAAsBO,KAAeC;IACxE,IAAI;QACF,MAAMN,gBAAgBH,iBAAiBC;QAEvC,IAAIE,eAAe;YACjB,MAAM,EAAEO,MAAM,EAAE,GAAI,MAAMC,IAAAA,oBAAM,EAACR,eAAeS,kBAAU;YAC1D,MAAMC,QAAQ,IAAIC,oBAAY,GAAGC,IAAI;YACrC,MAAMC,WAAW,MAAMH,MAAMI,UAAU,CAAC;gBAAEC,OAAO;oBAAER,QAAQS,OAAOT;gBAAQ;YAAE;YAE5E,IAAIM,UAAU;gBACZf,IAAIc,IAAI,GAAGC;gBACXP;YACF,OAAO;gBACLA,KAAK,IAAIW,4BAAa,CAAC,KAAK;YAC9B;QACF,OAAO;YACLX,KAAK,IAAIW,4BAAa,CAAC,KAAK;QAC9B;IACF,EAAE,OAAOC,OAAO;QACdZ,KAAK,IAAIW,4BAAa,CAAC,KAAK;IAC9B;AACF"}