{"version":3,"sources":["../../src/services/discussions.service.ts"],"sourcesContent":["import { PrismaClient, Topics } from '@prisma/client';\nimport { Service } from 'typedi';\n\n@Service()\nexport class DiscussionsService {\n  public topics = new PrismaClient().topics;\n  public likes = new PrismaClient().likes;\n  public saved = new PrismaClient().saved;\n  public async getAll(): Promise<Topics[]> {\n    const allTopics: Topics[] = await this.topics.findMany({\n      include: { CreatedBy: true, Likes: { include: { User: true } }, Saved: { include: { User: true } }, _count: { select: { Replies: true } } },\n      orderBy: { Title: 'asc' },\n    });\n    return allTopics;\n  }\n\n  public async likeTopic(TopicID: number, UserID: number): Promise<void> {\n    this.topics\n      .update({\n        where: { TopicID: TopicID },\n        data: { LikesNb: { increment: 1 } },\n      })\n      .then(() => this.likes.create({ data: { TopicID: TopicID, UserID: UserID } }))\n      .catch(err => console.log(err));\n  }\n\n  public async unlikeTopic(TopicID: number, UserID: number): Promise<void> {\n    this.topics\n      .update({\n        where: { TopicID: TopicID },\n        data: { LikesNb: { decrement: 1 } },\n      })\n      .then(() => this.likes.delete({ where: { TopicID_UserID: { TopicID: TopicID, UserID: UserID } } }))\n      .catch(err => console.log(err));\n  }\n\n  public async saveTopic(TopicID: number, UserID: number): Promise<void> {\n    this.saved.create({ data: { TopicID: TopicID, UserID: UserID } }).catch(err => console.log(err));\n  }\n\n  public async unsaveTopic(TopicID: number, UserID: number): Promise<void> {\n    this.saved.delete({ where: { TopicID_UserID: { TopicID: TopicID, UserID: UserID } } }).catch(err => console.log(err));\n  }\n\n  public async filtered(q: 'all' | 'popular' | 'recent' | 'name' | 'old', search: string): Promise<Topics[]> {\n    const alltopics: Topics[] = await this.topics.findMany({\n      where: {\n        Title: { contains: search, mode: 'insensitive' },\n      },\n      include: { CreatedBy: true, Likes: { include: { User: true } }, Saved: { include: { User: true } }, _count: { select: { Replies: true } } },\n    });\n\n    switch (q) {\n      case 'all':\n        // No sorting needed\n        break;\n      case 'popular':\n        alltopics.sort((a, b) => b.LikesNb - a.LikesNb);\n        break;\n      case 'recent':\n        alltopics.sort((a, b) => b.CreatedAt.getTime() - a.CreatedAt.getTime());\n        break;\n      case 'name':\n        alltopics.sort((a, b) => a.Title.localeCompare(b.Title));\n        break;\n      case 'old':\n        alltopics.sort((a, b) => a.CreatedAt.getTime() - b.CreatedAt.getTime());\n        break;\n    }\n\n    return alltopics;\n  }\n\n  public async create(Title: string, Content: string, CreatedAt: string, CreatorID: number): Promise<void> {\n    this.topics.create({ data: { Title: Title, Content: Content, CreatedAt: CreatedAt, CreatorID: CreatorID } }).catch(err => console.log(err));\n  }\n\n  public async getOne(TopicID: number): Promise<Topics> {\n    const question: Topics = await this.topics.findUnique({\n      where: { TopicID: TopicID },\n      include: { CreatedBy: true, Likes: { include: { User: true } }, Saved: { include: { User: true } }, _count: { select: { Replies: true } } },\n    });\n    return question;\n  }\n}\n"],"names":["DiscussionsService","getAll","allTopics","topics","findMany","include","CreatedBy","Likes","User","Saved","_count","select","Replies","orderBy","Title","likeTopic","TopicID","UserID","update","where","data","LikesNb","increment","then","likes","create","catch","err","console","log","unlikeTopic","decrement","delete","TopicID_UserID","saveTopic","saved","unsaveTopic","filtered","q","search","alltopics","contains","mode","sort","a","b","CreatedAt","getTime","localeCompare","Content","CreatorID","getOne","question","findUnique","PrismaClient","Service"],"mappings":"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"}